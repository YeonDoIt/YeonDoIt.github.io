---
title: "동기화란"
author: yeon
date: 2024-11-02 23:40:00 +0900
categories: [DEV, 운영체제]
tags: []
---

- 동시다발적으로 실행되는 프로세스들은 서로 협력하며 영향을 주고 받는다.
- 이 과정에서 자원의 일관성을 보장해야 한다. → 프로세스들의 **동기화**를 고려해야 한다.

![alt text](/assets/img/운영체제/동기화란/image.png)

## 동기화의 의미

- 공동의 목적을 위해 동시에 수행되는 프로세스
- e.g. 워드 프로세서 프로그램, 맞춤법 검사 프로세스, 입력 내용을 화면에 출력하는 프로세스, ..

### (프로세스) 동기화란?

- 프로세스들의 **수행 시기를 맞추는 것**
    - 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기
    - 상호 배제 : 동시에 접근해서는 안되는 자원에 하나의 프로세스만 접근하게 하기
- (실행의 문맥을 갖는 모든 대상은 동기화 대상이기에 스레드도 동기화 대상이다.)

### 실행 순서 제어를 위한 동기화 : reader writer problem

- Writer : Book.txt 파일에 값을 **저장하는** 프로세스
- Reader : Book.txt 파일에 저장된 값을 **읽어들이는** 프로세스

![alt text](/assets/img/운영체제/동기화란/image-1.png)

- Reader와 Writer 프로세스는 무작정 아무렇게나 실행되어선 안된다.
- Why ? 실행의 순서가 있기 때문
- Reader 프로세스는 ‘Book.txt 안에 값이 존재한다’는 특정 조건이 만족되어야만 실행 가능

### 상호 배제를 위한 동기화 : Bank account problem

- 공유가 불가능한 자원의 동시 사용을 피하기 위한 동기화
- **한 번에 하나의 프로세스만 접근해야 하는 자원**에 동시 접근을 피하기 위한 동기화
    - ex) 현재 계좌에 잔액 : 10만원
    - 프로세스 A는 현재 잔액에 2만원을 추가하는 프로세스
    - 프로세스 B는 현재 잔액에 5만원을 추가하는 프로세스

![alt text](/assets/img/운영체제/동기화란/image-2.png)

## 동기화 예제

### Producer & Consumer problem

- 물건을 계속해서 생산하는 생산자(producer, 프로세스 혹은 스레드)

```
생산자 () {
    버퍼에 데이터 삽입
    '총합' 변수 1 증가
}
```

- 물건을 계속해서 소비하는 소비자(consumer, 프로세스 혹은 스레드)

```
소비자 () {
    버퍼에서 데이터 빼내기
    '총합' 변수 1 감소
}
```

- '총합' 변수 공유

```
총합 = 10

생산자 () {
    버퍼에 데이터 삽입
    '총합' 변수 1 증가
}

소비자 () {
    버퍼에서 데이터 빼내기
    '총합' 변수 1 감소
}
```

> Q : 이 상태에서 생산자를 100,000번, 소비자를 100,000번 실행하는 ‘총합’은?   
A : 때로는 0과 다른 값이 되거나, 오류가 발생하기도 하지만,   
결과 1 : producer, consumer 스레드 실행 이후 합계 : 63078   
결과 2 : producer, consumer 스레드 실행 이후 합계 : -13750   
동기화가 되지 않았기 때문에 발생한 문제   
동시에 접근해서는 안되는 자원(총합)에 동시에 접근해서 발생한 문제

## 공유 자원과 임계 구역

![alt text](/assets/img/운영체제/동기화란/image-3.png)

### 공유 자원

- 여러 프로세스 혹은 스레드가 공유하는 자원
- 전역 변수, 파일, 입출력장치, 보조기억장치, ..

### 임계 구역

- 동시에 실행하면 문제가 발생하는 지원에 접근하는 코드 영역
- 앞선 예시의 ‘총합’ 변수, ‘잔액’ 변수, ..

### 레이스 컨디션

- 임계 구역에 동시에 접근하려고 하면? → 문제가 발생한다.
- 임계 구역에 동시에 접근하면 자원의 일관성이 깨질 수 있다. 이를 **레이스 컨디션(race condition)**이라고 한다.

![alt text](/assets/img/운영체제/동기화란/image-4.png)
![alt text](/assets/img/운영체제/동기화란/image-5.png)

### 운영체제가 임계구역 문제를 해결하는 세 가지 원칙 (상호 배제를 위한 동기화를 위한 세 가지 원칙)

1. 상호 배제 (mutual exclusion) : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 들어올 수 없다.
2. 진행 (progress) : 임계 구역에 어떤 프로세스도 진입하지 않았다면 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
3. 유한 대기 (bounded waiting) : 한 프로세스가 임계 구역에 진입하고 싶다면 언젠가는 임계 구역에 들어올 수 있어야 한다. (임계 구역에 들어오기 위해 무한정 대기해서는 안된다.)